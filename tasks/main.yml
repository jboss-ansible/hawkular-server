---
- name: Install OpenJDK
  yum: name=java-1.8.0-openjdk-headless state=present
  become: yes
  become_user: root

- name: Download Hawkular Services
  get_url: url=http://download.jboss.org/hawkular/hawkular/{{ hawkular_version }}/{{ hawkular_name }}.tar.gz dest={{ download_directory }}/{{ hawkular_name }}.tar.gz

- name: Unzip Hawkular Services
  unarchive: src="{{ download_directory }}/{{ hawkular_name }}.tar.gz" dest="{{ target_directory }}" copy=no
  become: yes
  become_user: root

- name: Check port availability
  wait_for: host={{ inventory_hostname }} port={{ hawkular_http_port }} state=stopped timeout=10

- name: Start Hawkular Services
  shell: "{{ target_directory }}/hawkular-{{ hawkular_version }}/bin/standalone.sh -Djboss.http.port={{ hawkular_http_port }} -Djboss.bind.address={{ hawkular_bind_address }} &"
